I"€)<p>Cet article est repris dâ€™une publication initiale sur le blog <a href="https://e-ducat.fr">e-ducat.fr</a>.</p>

<p>Le remplissage moyen dâ€™un bloc Bitcoin atteint depuis fin 2016 presque 100%. Il est en progression linÃ©aire depuis 2012 et câ€™est un autre signe du succÃ¨s de Bitcoin.</p>

<p>De fait, ceci peut retarder de plusieurs heures la confirmation de certaines transactions, celles dont les commissions de rÃ©seau sont jugÃ©es trop basses par les mineurs.</p>

<p>Pour une confirmation en 10 minutes, on estime aujourdâ€™hui que le wallet du payeur doit prÃ©voir une commission de rÃ©seau de 200 satoshis/octets (environ 0,002 â‚¬/octet).</p>

<p>Une transaction standard dÃ©pensant plusieurs entrÃ©es-sources (inputs) et crÃ©ditant plusieurs sorties-destinations (outputs) est un message signÃ© pouvant occuper 250 octets et jusquâ€™Ã  1 000 octets ou plus (en fonction du nombre dâ€™entrÃ©es/sorties et de la complexitÃ© des entrÃ©es): la commission recommandÃ©e se situe donc entre 0,50 â‚¬ et 2 â‚¬.</p>

<p>Cependant si vous pouvez attendre quelques heures, une commission bien infÃ©rieure sera suffisante: le 18 mars, jâ€™ai envoyÃ© un micro-paiement dans une transaction de 1500 octets ( <a href="https://live.blockcypher.com/btc/tx/a1e8de90cc04fcd4a96da47ffd9566e68cf8872472c77a161c6c20590fc927c6/">a1e8de90cc04fcd4a96da47ffd9566e68cf8872472c77a161c6c20590fc927c6</a> )
minÃ©e par BTC.com pour moins de 10 sat/byte en moins de 10 heures.</p>

<p>Les affirmations alarmistes dâ€™une minoritÃ© concernant une congestion soit-disant fatale du rÃ©seau sont donc largement exagÃ©rÃ©es, comme toutes les affirmations alarmistes rÃ©pandues depuis 2010 et toujours dÃ©menties dans les faits par la rÃ©silience de Bitcoin.</p>

<p>En fait, on peut prÃ©dire que, quelque soit la taille des blocs Bitcoins, ils seront pleins.
Câ€™est mÃªme le signe dâ€™une utilisation optimale des capacitÃ©s du rÃ©seau.</p>

<p>Augmenter la taille des blocs nâ€™est pas une stratÃ©gie de passage Ã  lâ€™Ã©chelle (scaling), ni mÃªme une tactique.
Si un rÃ©seau de paiement mondial doit pouvoir traiter plusieurs dizaines de milliers de transactions par secondes, il faudrait que le rÃ©seau Bitcoin fasse circuler environ 5 Moctets/s de donnÃ©es et que la blockchain Bitcoin intÃ¨gre des blocs dâ€™au moins <strong>3 Gigaoctets</strong>.</p>

<p>Le rÃ©seau Bitcoin nâ€™est simplement pas fait pour Ã§a: il reprÃ©sente <strong>la premiÃ¨re couche dâ€™un empilement de protocoles complÃ©mentaires qui, combinÃ©s, formeront lâ€™internet des transactions</strong>.</p>

<p>Aujourdâ€™hui le web fonctionne dÃ©jÃ  et depuis longtemps grÃ¢ce Ã  un assemblage de protocoles complÃ©mentaires comme TCP/IP, HTTP, WebSocket ou DNS.</p>

<p>Les protocoles construits sur le protocole Bitcoin ( dits â€œLayer 2â€) tels que  <a href="https://lightning.network">Lightning</a> ou <a href="https://github.com/BUSEC/TumbleBit">Tumblebit</a> permettront de diffuser des transactions â€œoff-chainâ€, potentiellement jusquâ€™Ã  des millions de transactions par secondes.</p>

<p>En effet, ces protocoles crÃ©ent des <strong>canaux de paiements</strong> oÃ¹ seules les transactions dâ€™ouverture et de fermeture du canal nÃ©cessitent dâ€™Ãªtre minÃ©es. 
Entre ces deux transactions, des milliers de transactions peuvent sâ€™Ã©changer en toute sÃ©curitÃ© et sans tiers de confiance entre Alice et Bob.</p>

<p>Le rÃ©seau Lightning ne se contente pas dâ€™offrir une solution de scalabilitÃ© au rÃ©seau Bitcoin: il amÃ©liore aussi la confidentialitÃ© des transactions en fonctionnant sur le principe du rÃ©seau <a href="https://www.torproject.org">TOR</a> pour acheminer la transaction en mode chiffrÃ© de Alice Ã  Bob.</p>

<p>Tumblebit prÃ©sente des caractÃ©ristiques similaires Ã  Lightning: mon prochain article lui sera consacrÃ©.</p>

<p>En attendant, les â€œalarmistesâ€ sont parvenus Ã  faire croire que lâ€™intitiative â€œBitcoin Unlimitedâ€ (BTU en abrÃ©gÃ©), consistant Ã  supprimer la limite de 1 Mo par bloc, serait une solution viable.</p>

<p>Voici pourquoi je nâ€™y crois pas, explication destinÃ©e aux possesseurs de bitcoins et aux clients de Paymium qui sâ€™inquiÃ¨tent des rumeurs de â€œhard forkâ€.</p>

<p>En rÃ©sumÃ©, un â€œ<strong>hard fork</strong>â€ est une modification du protocole qui  <strong>enlÃ¨ve</strong> une rÃ¨gle du protocole, ici la rÃ¨gle qui limite la taille dâ€™un bloc Ã  1 Mo.</p>

<p>AprÃ¨s le hard fork, les nouveaux blocs de 2 Mo sont valides pour les clients mis Ã  jour mais les  anciens noeuds (non mis Ã  jour) rejettent ces blocs trop gros selon eux.</p>

<p>Les mineurs qui refusent la suppression dâ€™une rÃ¨gle considÃ¨ront les nouveaux blocs comme invalides et continueront donc Ã  miner la chaÃ®ne dâ€™avant mÃªme si la nouvelle chaÃ®ne arrivait Ã  rÃ©unir davantage de puissance de calcul.
Le hard fork crÃ©e donc de facto un altcoin qui va vivre sur une chaÃ®ne indÃ©pendante commenÃ§ant au niveau du bloc oÃ¹ le hard fork sâ€™est produit.</p>

<p><img src="/assets/hardfork.png" alt="Hard Fork" /></p>

<p><em>Hard Fork</em></p>

<p>A lâ€™inverse, un â€œ<strong>soft forkâ€ rajoute une ou plusieurs rÃ¨gles au protocole</strong>.
Un exemple absurde mais instructif serait un soft fork qui diminuerait la taille des blocs Ã  500 ko.
Dans ce cas, un mineur non mis Ã  jour produira des blocs de 1 Mo qui seront refusÃ©s par les noeuds mis Ã  jour.
Par contre, les blocs produits par des mineurs mis Ã  jour seront acceptÃ©s par tout le monde.
Ainsi, lors dâ€™un soft fork, les mineurs qui ne sont pas Ã  jour verront leurs blocs devenir orphelins si et seulement si la nouvelle rÃ¨gle a rÃ©uni une majoritÃ© simple (51% ou plus) de la puissance de calcul.</p>

<p><img src="/assets/softfork.png" alt="soft Fork" /></p>

<p><em>Soft Fork</em></p>

<p><a href="https://bitcoincore.org/en/2016/01/26/segwit-benefits/">SegWit</a> qui exige, entre autres, un numÃ©ro de version pour les scripts,est un autre exemple de soft fork, beaucoup plus pertinent.</p>

<p>De nouveaux <a href="http://bitcoinscri.pt">opcodes</a> voire de nouveaux systÃ¨mes de scripts peuvent Ãªtre introduits en incrÃ©mentant le numÃ©ro de version des scripts.
Ces nouveaux scripts seront correctement interprÃ©tÃ©s par les noeuds SegWit pour dÃ©penser une adresse P2SH SegWit (P2SH-P2WSH) et ces noeuds accepteront aussi une transaction dÃ©pensant une adresse P2SH Ã  lâ€™ancienne.</p>

<p>Bien entendu, il faudra mettre Ã  jour son wallet pour envoyer et recevoir des transactions SegWit.
SegWit est dÃ©jÃ  intÃ©grÃ© dans <a href="https://bitcoin.org/fr/telecharger">Bitcoin Core</a> depuis la version 0.13.1 mais lâ€™activation de cette fonctionnalitÃ© interviendra seulement lorsque 95% des mineurs auront signalÃ© leur accord.</p>

<p>Notez que les transactions SegWit ne seront pas correctement traitÃ©es par le rÃ©seau avant lâ€™activation et que, dâ€™ici lÃ , il ne faut donc pas anticiper en envoyant des fonds vers une adresse P2SH SegWit au risque de les geler jusquâ€™Ã  lâ€™activation.</p>

<p>En rÃ©sumÃ© et <strong>pour rassurer ceux qui auraient Ã©tÃ© alarmÃ©s par la perspective dâ€™un hard fork â€œBTUâ€</strong>, le trading BTC/EUR et les mouvements en Euros ne seraient pas affectÃ©s mais voici ce qui se passerait chez <a href="https://paymium.com">Paymium</a> en cas de hard fork concernant les retraits de BTC:</p>

<ol>
  <li>suspension temporaire des retraits BTC pour environ une journÃ©e afin dâ€™Ã©valuer les consÃ©quences du hard fork: il est possible que les mineurs abandonnent assez rapidement (au bout de quelques heures) le minage BTU. Dans ce cas, les retraits BTC reprendraient aussitÃ´t.</li>
  <li>affichage du solde BTU, Ã©gal au solde BTC dâ€™avant le hard fork: tout se passe comme si chaque client avait dÃ©sormais deux fois plus de coins mais la valeur du BTC pre-fork serait rÃ©partie sur les deux coins.</li>
  <li>sÃ©paration des coins par Paymium</li>
  <li>reprise du traitement des demandes de retraits BTC</li>
  <li>traitement des demandes de retraits BTU.</li>
</ol>

<p>La <strong>sÃ©paration des coins</strong> sâ€™impose car une transaction post-fork qui dÃ©pense des BTC reÃ§us pre-fork est en gÃ©nÃ©ral valide sur les deux chaines.</p>

<p>Sans cette prÃ©caution, nous serions exposÃ©s Ã  une <strong>â€œreplay attackâ€</strong>: si vous payez par exemple un marchand 1 BTC pour un bien de 800 â‚¬ en supposant que câ€™est le taux BTC/EUR post-fork et que le BTU vaut 200 â‚¬ au mÃªme moment, le marchand pourrait diffuser votre transaction BTC sur le rÃ©seau BTU et rÃ©cupÃ©rer ainsi un supplÃ©ment de 200 â‚¬.</p>

<p>Il convient donc de dÃ©placer les coins (BTC et BTU) en utilisant des transactions diffÃ©rentes.
Pour cela, comme suggÃ©rÃ© par Thomas Voegtlin, dÃ©veloppeur du wallet <a href="http://docs.electrum.org/en/latest/hardfork.html">Electrum</a>, nous pourrons lancer 2 instances de Electrum simultanÃ©ment, lâ€™une depuis un rÃ©pertoire BTC, lâ€™autre depuis un rÃ©pertoire BTU.</p>

<p>Nous pourrons crÃ©er ensuite une transaction RBF (replace by fee) renvoyant les coins vers Paymium et la diffuser sur chacun des 2 rÃ©seaux (BTC et BTU).</p>

<p>Lorsque la transaction sera visible sur chacun des 2 rÃ©seaux, nous pourrons augmenter la commission de rÃ©seau sur notre wallet Electrum BTC et diffuser cette nouvelle version de notre transaction, qui portera une transaction id diffÃ©rente Ã  cause du montant de commission diffÃ©rent, sur le rÃ©seau BTC.</p>

<p>Il  faut diffuser cette nouvelle transaction avant que la premiÃ¨re ne soit confirmÃ©e sur le rÃ©seau BTC.
Le rÃ©seau BTU ne propagera pas cette transaction car les noeuds BTU nâ€™implÃ©mentent pas RBF.</p>

<p>AprÃ¨s confirmation par les 2 rÃ©seaux, nous pourrons alors vÃ©rifier que cette transaction nous renvoyant les fonds porte <strong>une tx id diffÃ©rente dans les blockchains BTC et BTU</strong>, câ€™est Ã  dire que la sÃ©paration des coins est effective.</p>

<p><img src="/assets/bitcoin_unlimited_nodes.png" alt="RÃ©partition des relais du rÃ©seau Bitcoin" />
<em>Nombre de Nodes Bitcoin Core (en bleu) vs Nodes Bitcoin Unlimited (en vert)</em></p>

<p>Soulignons encore une fois que la probabilitÃ© dâ€™un hard fork reste trÃ¨s faible car les noeuds Bitcoin Unlimited ne reprÃ©sentent aujourdâ€™hui (29 mars 2017) que 10% environ des noeuds du rÃ©seau Bitcoin Core sans signe indiscutable dâ€™un changement en faveur de Bitcoin Unlimited.</p>

<p>Pour en savoir plus sur les risques et avantages de soft fork vs hard fork, lire lâ€™<a href="https://petertodd.org/2016/soft-forks-are-safer-than-hard-forks">article de Peter Todd</a> (en anglais) sur la question.</p>
:ET